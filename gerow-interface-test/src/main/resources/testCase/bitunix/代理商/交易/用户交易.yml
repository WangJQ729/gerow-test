name: 用户交易
story: trade
invocationCount: 1
dataProvider:
  - partnersadmin_account: admin
    partnersadmin_password: admin
    partner_email: gerow1@qq.com
    partner_password: Aa123456
    symbol: BTCUSDT
    amount: 0.16
    side: 2
    dataProvider:
      - userId: 46949
beforeClass:
  name: 登录合伙人系统
  step:
    - keyWord: 登录partnersadmin
    - keyWord: 登录partners
    - keyWord: 用户列表
    - keyWord: 合伙人列表
testMethod:
  - name: 用户合约交易
    step:
      - keyWord: 通过uid获取用户token
      - keyWord: 直客佣金查询
      - keyWord: 增加合约账户资产
      - keyWord: 市价开仓
      - keyWord: 持有仓位信息
      - keyWord: U本位合约历史委托
      - keyWord: 直客佣金查询
        intervals: 10000
        untilWait: 600
        assertion:
          - json:
              $.result.items[0].makerFee: ${__BeanShell(${makerFee} + ${openDealFee})}
            assertionType: EIGHTDECIMALPLACES
      - keyWord: 市价平仓
      - keyWord: U本位合约历史委托-平仓
      - keyWord: 直客佣金查询
        intervals: 10000
        untilWait: 600
        assertion:
          - json:
              $.result.items[0].makerFee: ${__BeanShell(${makerFee} + ${closeDealFee})}
            assertionType: EIGHTDECIMALPLACES
  - name: 用户现货交易
    step:
      - keyWord: 通过uid获取用户token
      - keyWord: 直客佣金查询-现货
      - keyWord: 代理商现货历史委托
      - keyWord: 增加合约账户资产
      - keyWord: 合约划转现货
      - keyWord: 现货市价买入
      - keyWord: web现货历史委托
      - keyWord: 代理商现货历史委托
      - keyWord: 直客佣金查询-现货
        intervals: 5000
        untilWait: 600
        assertion:
          - json:
              $.result.items[0].takerRebate: ${__BeanShell(${takerRebate} + ${webFee} * (${totalExchangeRatio} - ${exchangeRatio}) / 100)}
              $.result.items[0].takerFee: ${__BeanShell(${takerFee} + ${webFee})}
              $.result.items[0].takerTradeAmount: ${__BeanShell(${takerTradeAmount} + ${progress })}
              $.result.items[0].takerRealFee: ${__BeanShell(${takerTradeAmount} + ${webFee})}
            assertionType: EIGHTDECIMALPLACES
            valueType: BIGDECIMAL
