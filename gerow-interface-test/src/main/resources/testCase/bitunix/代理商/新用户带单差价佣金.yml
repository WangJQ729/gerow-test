name: 新用户带单差价佣金
story: partners
invocationCount: 1
beforeClass:
  name: 登录合伙人后台
  step:
    - keyWord: 登录partners
    - keyWord: 获取合伙人信息
    - keyWord: 登录partnersadmin
    - keyWord: 获取合伙人邀请码
    - keyWord: 合伙人列表
testMethod:
  - name: 用户带单交易
    dataProvider:
      - futureRatio: 20
        exchangeRatio: 30
    step:
      - keyWord: 代理商后台返佣发放
      - keyWord: 代理商后台差价佣金统计
      - keyWord: 佣金发放明细
      - keyWord: 分后台佣金发放查询
      - keyWord: 快捷注册-合伙人邀请码-随机邮箱
      - keyWord: 升级为合伙人
      - keyWord: 分后台获取用户信息
      - keyWord: 增加合约账户资产
      - keyWord: 通过uid获取用户token
      - keyWord: 合约划转现货
      - keyWord: 申请成为交易员
        headers:
          Token: ${token}
      - keyWord: 获取带单子账户token
        headers:
          Token: ${token}
      - keyWord: 带单子账户市价开仓
      - keyWord: 带单子账户持有仓位信息
      - keyWord: 直客合约历史委托
      - keyWord: 代理商后台返佣发放
      - keyWord: 代理商后台差价佣金统计
      - keyWord: 佣金发放明细
      - keyWord: 分后台佣金发放查询-合伙人开仓
      - keyWord: 差价佣金查询
      - keyWord: 带单子账户持有仓位信息
      - keyWord: 带单子账户平仓
      - keyWord: 直客合约历史委托
        extractor:
          - json:
              closeDealFee: $.result.items[0].fee
      - keyWord: 代理商后台返佣发放
      - keyWord: 代理商后台差价佣金统计
      - keyWord: 佣金发放明细
      - keyWord: 分后台佣金发放查询-合伙人平仓
      - keyWord: 差价佣金查询
        assertion:
          - json:
              $.result.items[0].makerFee: ${openDealFee}
              $.result.items[0].makerRealFee: ${openDealFee}
              $.result.items[0].rebateRatio: ${__groovy((${totalFutureRatio} - ${futureRatio}) / 100)}
              $.result.items[0].makerRebate: ${__groovy(${openDealFee} * (${totalFutureRatio} - ${futureRatio}) / 100)}
            assertionType: EIGHTDECIMALPLACES
      - keyWord: 合伙人佣金查询-平仓
afterClass:
  name: 获取taskID和模板
  step:
    - keyWord: 获取子账户Uid
      headers:
        Token: ${token}
    - keyWord: 取消带单
      headers:
        Token: ${token}