name: 统一前置处理
#所有测试执行前执行
beforeSuite:
  name: 登录mp后台
  step:
    - byName: 获取MP后台地址
    - byName: 进入主页
    - byName: 获取shop_id
    - byName: 获取子账号
    - name: 获取多销跳转链接
      url: /api/fishpond/auth/get_sub_login_url
      variables:
        sub_nick: ${shopName}
        platform: ${platform}
      method: GET
      assertion: [json: {$.code: 0}]
      extractor:
        - json:
            seller_url: $.data.url
    - name: 进入多销主页
      host: ""
      url: ${seller_url}
      method: GET
      responseType: DEFAULT
    - name: 登录test-tools
      host: ${test_tools}
      url: /api/v1/login/
      method: POST
      body: |
        {"username":"wangjianqiang","password":"wangjianqiang123456"}
      assertion: [json: {$.code: 0}]
      extractor:
        - json:
            token: $.data.token
          site: TESTSUIT
    - name: 获取多销风险控制
      url: /api/fishpond/risk/buyer/setting
      method: GET
      extractor:
        - json:
            risk_data: $.data
          site: TESTSUIT
    - name: 设置多销风险控制
      url: /api/fishpond/risk/buyer/setting
      method: POST
      body: |
        {"day_sent": 300,"month_send": 300,"message_interval": 1}
      assertion: [json: {$.code: 0}]
afterSuite:
  name: 测试完成恢复风险控制配置
  step:
    - byName: 设置多销风险控制
      body: ${risk_data}
