name: 咨询未下单
dataProvider:
  - question: 在吗？
testMethod:
  - name: 咨询未下单分群-买家咨询
    step:
      - name: 新建顾客分群
        url: /api/zhike/customer_group/create
        method: POST
        body: |
          {"customer_group":{"name":"${__time(yyyyMMdd_HHmmss,group_name)}","cond":{"select_cond":{"op":"and","child_conds":[{"op":"and","child_conds":[{"cond":{"type":"last_order_state","rule":{"type":"last_order_state","state":"asked","max_time":1575251759,"min_time":1575165359,"goods":[]}}}]}]},"exclude_cond":null},"shop_id":"${shop_id}"}}
        bodyEditor:
          json:
            $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.min_time: ${__javaScript(${__time(/1000)},)}
            $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.max_time: ${__javaScript(${__time(/1000)}+600,)}
        assertion: [json: {$.code: 0}]
      - byName: 查看分群列表-获取新分群ID
      - byName: 校验初始客群人数为0
      - byName: 发送消息给商家
      - byName: 校验初始客群人数为1
  - name: 咨询未下单分群-咨询后下单-${order_state_name}
    dataProvider:
      - order_state: created
        order_state_name: 下单未付款
      - order_state: paid
        order_state_name: 已付款
      - order_state: deposited
        order_state_name: 已付定金未付尾款
      - order_state: signed
        order_state_name: 已签收
      - order_state: part_shipped
        order_state_name: 部分发货
      - order_state: shipped
        order_state_name: 全部发货
      - order_state: succeeded
        order_state_name: 交易成功
    step:
      - byName: 新建顾客分群
      - byName: 查看分群列表-获取新分群ID
      - byName: 校验初始客群人数为0
      - byName: 发送消息给商家
      - byName: 校验初始客群人数为1
      - byName: 通过pulsar推送订单消息-指定用户
      - byName: 校验初始客群人数为0
afterMethod:
  name: 删除智能分群
  step:
    - byName: 删除智能分群