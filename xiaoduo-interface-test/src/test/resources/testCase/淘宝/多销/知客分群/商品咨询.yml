name: 商品咨询
enable: false
dataProvider:
  - order_state: paid
    order_state_name: 已付款
    goods_id: https://item.taobao.com/item.html?id=607123276832
beforeClass:
  name: 设置分群
  severity: CRITICAL
  step:
    - byName: 新建顾客分群
      bodyEditor:
        json:
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.type: last_order_state
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.type: last_order_state
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.state: asked
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.min_time: ${__BeanShell(${__time(/1000)}-1000,)}
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.max_time: ${__BeanShell(${__time(/1000)}+1000,)}
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.rel_time: 0
          $.customer_group.cond.select_cond.child_conds[0].child_conds[0].cond.rule.goods: ["607123276832"]
    - byName: 查看分群列表-获取新分群ID
    - byName: 获取初始化后的分群人数
testMethod:
  - name: 咨询了指定商品，但该商品在指定时间段已下单
    severity: CRITICAL
    step:
      - byName: 发送消息给商家
        bodyEditor:
          json:
            $.pin: cntaobao${__RandomName(buyer_id)}
            $.q: ${__DES3Cipher(${goods_id},,)}
      - byName: 通过pulsar推送订单消息-指定商品
      - byName: 校验分群人数未增加
      - byName: 校验分群人数未增加
#afterClass:
#  name: 删除智能分群
#  step:
#    - byName: 删除智能分群