name: 顾客负面情绪监控
dataProvider:
  - category_name: 顾客负面情绪
    dataProvider:
      - emotion_name: 对客服态度不满
        emotion: c4
        algo_emotion: 4
        question:
          - 态度怎么这么差
          - 服务态度太差
      - emotion_name: 对发货物流不满
        emotion: c5
        algo_emotion: 5
        question: 发货怎么这么慢
      - emotion_name: 对产品不满
        emotion: c6
        algo_emotion: 6
        question:
          - 什么垃圾东西
          - 东西太垃圾了
          - 产品质量太差了
      - emotion_name: 其他不满意
        emotion: c7
        algo_emotion: 7
        question:
          - 一点都不满意
      - emotion_name: 顾客骂人
        emotion: c8
        algo_emotion: 8
        question:
          - 去死
          - 你他妈的
          - 大傻逼
      - emotion_name: 对收货少件不满
        emotion: c9
        algo_emotion: 9
        question: 你发的货怎么少了几件
testMethod:
  - name: ${category_name}-${emotion_name}-扣${emotion_score}分-开启-${question}
    description: |
      """</br>
      用例描述：</br>
      1、${category_name}-${emotion_name}-开启-${question}。</br>
      </br>
      测试步骤</br>
      1、${category_name}</br>
      2、开启${emotion_name}检查</br>
      3、发送(${question})给商家</br>
      4、查看对话详情-校验质检结果</br>
      """
    dataProvider:
      - emotion_score: 1
      - emotion_score: 4
    severity: NORMAL
    step:
      - name: 开启情绪管理开关
        host: ${mc_test}
        url: /api/v1/emotion/update
        method: POST
        body: |
          {"emotion":{"name":"${emotion_name}","category_name":"${category_name}","type":"${emotion}","score":${emotion_score},"check":true}}
        assertion: [json: {$.code: 0}]
      - byName: 发送消息给商家-随机买家
      - name: 查询质检会话列表
        host: ${mc_test}
        url: /api/v1/dialog/list
        method: POST
        body: |
          {
              "dialog_type":0,
              "check_type":0,
              "qc_word_type":0,
              "cnick":"${buyer_id}",
              "sort_type":0,
              "radar_type":0,
              "begin_timestamp":${__BeanShell(${__time(/1000)}-1*60*60*24,)},
              "end_timestamp":${__BeanShell(${__time(/1000)}+1*60*60*24,)},
              "skip":0,
              "limit":20
          }
        untilWait: 10
        assertion: [json: {$.code: 0}]
        extractor:
          - json:
              dialog_id: $.data.dialogs[*].id
      - name: 查看对话详情
        host: ${mc_test}
        url: /api/v1/dialog/messages
        variables:
          dialog_id: ${dialog_id}
        method: GET
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion: ["${emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_name: ["${emotion_name}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].algo_emotion: ["${algo_emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_score: ["${emotion_score}"]
  - name: ${category_name}-${emotion_name}-扣${emotion_score}分-关闭-${question}
    description: |
      """</br>
      用例描述：</br>
      1、${category_name}-${emotion_name}-关闭-${question}。</br>
      </br>
      测试步骤</br>
      1、${category_name}</br>
      2、开启${emotion_name}检查</br>
      3、发送(${question})给商家</br>
      4、查看对话详情-校验质检结果</br>
      """
    dataProvider:
      - emotion_score: 1
    severity: NORMAL
    step:
      - byName: 开启情绪管理开关
        name: 关闭情绪管理开关
        bodyEditor:
          json:
            $.emotion.check: false
      - byName: 发送消息给商家-随机买家
      - byName: 查询质检会话列表
      - byName: 查看对话详情
        name: 查看对话详情-检查开关关闭
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion: [c0]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_name: [中性]
              $.data.messages[?(@.content=='${question}' && @.source==0)].algo_emotion: ["${algo_emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_score: [0]