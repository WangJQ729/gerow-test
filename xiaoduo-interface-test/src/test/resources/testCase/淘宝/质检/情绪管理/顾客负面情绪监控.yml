name: 顾客负面情绪监控
dataProvider:
  - category_name: 顾客负面情绪
    emotion_name: 对客服态度不满
    emotion: c4
    algo_emotion: 4
    dataProvider:
      - question: 态度怎么这么差
      - question: 服务态度太差
  - category_name: 顾客负面情绪
    emotion_name: 对发货物流不满
    emotion: c5
    algo_emotion: 5
    dataProvider:
      - question: 发货怎么这么慢
  - category_name: 顾客负面情绪
    emotion_name: 对产品不满
    emotion: c6
    algo_emotion: 6
    dataProvider:
      - question: 什么垃圾东西
      - question: 东西太垃圾了
      - question: 产品质量太差了
  - category_name: 顾客负面情绪
    emotion_name: 其他不满意
    emotion: c7
    algo_emotion: 7
    dataProvider:
      - question: 一点都不满意
  - category_name: 顾客负面情绪
    emotion_name: 顾客骂人
    emotion: c8
    algo_emotion: 8
    dataProvider:
      - question: 去死
      - question: 你他妈的
      - question: 大傻逼
  - category_name: 顾客负面情绪
    emotion_name: 对收货少件不满
    emotion: c9
    algo_emotion: 9
    dataProvider:
      - question: 你发的货怎么少了几件
testMethod:
  - name: ${category_name}-${emotion_name}-扣${emotion_score}分-开启-${question}
    dataProvider:
      - emotion_score: 1
    severity: NORMAL
    step:
      - name: 开启情绪管理开关
        host: ${mc_test}
        url: /api/v1/emotion/update
        method: POST
        body: |
          {"emotion":{"name":"${emotion_name}","category_name":"${category_name}","type":"${emotion}","score":${emotion_score},"check":true}}
        assertion: [json: {$.code: 0}]
      - byName: 发送消息给商家-随机买家
      - name: 查询质检会话列表
        host: ${mc_test}
        url: /api/v1/dialog/list
        method: POST
        body: |
          {
              "dialog_type":0,
              "check_type":0,
              "qc_word_type":0,
              "cnick":"${buyer_id}",
              "sort_type":0,
              "radar_type":0,
              "begin_timestamp":${__BeanShell(${__time(/1000)}-1*60*60*24,)},
              "end_timestamp":${__BeanShell(${__time(/1000)}+1*60*60*24,)},
              "skip":0,
              "limit":20
          }
        untilWait: 10
        assertion: [json: {$.code: 0}]
        extractor:
          - json:
              dialog_id: $.data.dialogs[*].id
      - name: 查看对话详情
        host: ${mc_test}
        url: /api/v1/dialog/messages
        variables:
          dialog_id: ${dialog_id}
        method: GET
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion: ["${emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_name: ["${emotion_name}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].algo_emotion: ["${algo_emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_score: ["${emotion_score}"]
  - name: ${category_name}-${emotion_name}-扣${emotion_score}分-关闭-${question}
    dataProvider:
      - emotion_score: 1
    severity: NORMAL
    step:
      - byName: 开启情绪管理开关
        name: 关闭情绪管理开关
        bodyEditor:
          json:
            $.emotion.check: false
      - byName: 发送消息给商家-随机买家
      - byName: 查询质检会话列表
      - byName: 查看对话详情
        name: 查看对话详情-检查开关关闭
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion: [c0]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_name: [中性]
              $.data.messages[?(@.content=='${question}' && @.source==0)].algo_emotion: ["${algo_emotion}"]
              $.data.messages[?(@.content=='${question}' && @.source==0)].emotion_score: [0]