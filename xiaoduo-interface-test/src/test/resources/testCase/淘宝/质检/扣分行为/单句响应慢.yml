name: ${abnormal_name}
dataProvider:
  - abnormal_name: 单句响应慢
    abnormal_type: 8
    dataProvider:
      - category_name: 户外烧烤
        dataProvider:
          - question: 冰袋可以维持多久
            answer: 亲亲这个是要看当地气温的哦
          - question: 你他妈的
            answer: 亲亲消消气
beforeClass:
  name: 获取扣分行为类型id
  step:
    - byName: 跟进类目名称获取类目
    - byName: 切换类目-指定类目id
    - byName: 获取扣分行为列表
testMethod:
  - name: ${abnormal_name}-${category_name}-开启-${sleep_time}秒后回复-扣${abnormal_score}分
    description: |
      """</br>
      用例描述：</br>
      1、${abnormal_name}-${category_name}--开启-${question}。</br>
      </br>
      测试步骤</br>
      1、${category_name}</br>
      2、开启${abnormal_name}检查</br>
      3、发送(${question})给商家</br>
      4、${sleep_time}秒后商家回复(${answer})</br>
      5、查看对话详情-校验质检结果</br>
      """
    dataProvider:
      - abnormal_score:
          - 1
#          - 4
        sleep_time:
          - 60
#          - 61
#          - 62
    severity: NORMAL
    step:
      - byName: 开启扣分分行为监控开关
        name: 开启单句响应慢监控开关
        bodyEditor:
          json:
            $.score: ${__BeanShell(${abnormal_score})}
            $.check: true
            $.special_settings.reply_timeout: "1"
      - byName: 发送消息给商家-随机买家
      - byName: 发送消息给买家
        sleep: ${sleep_time}
      - byName: 查询质检会话列表
      - byName: 查看对话详情-扣分行为
  - name: ${abnormal_name}-${category_name}--开启-${sleep_time}秒后回复-扣分${abnormal_score}
    description: |
      """</br>
      用例描述：</br>
      1、${abnormal_name}-${category_name}--开启-${question}。</br>
      </br>
      测试步骤</br>
      1、${category_name}</br>
      2、开启${abnormal_name}检查</br>
      3、发送(${question})给商家</br>
      4、${sleep_time}秒后商家回复(${answer})</br>
      5、查看对话详情-校验质检结果</br>
      """
    dataProvider:
      - abnormal_score:
          - 1
#          - 4
        sleep_time:
          - 1
#          - 30
          - 59
    severity: NORMAL
    step:
      - byName: 开启单句响应慢监控开关
      - byName: 发送消息给商家-随机买家
      - byName: 发送消息给买家
        sleep: ${sleep_time}
      - byName: 查询质检会话列表
      - byName: 查看对话详情-扣分行为
        name: 查看对话详情-无扣分行为
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${answer}' && @.source==1)].abnormal_score: [[]]
afterClass:
  name: 测试结束后关闭质检
  step:
    - byName: 关闭扣分分行为监控开关