name: ${abnormal_name}
dataProvider:
  - abnormal_name: 生硬拒绝
    abnormal_type: 4
    dataProvider:
      - category_name: 户外烧烤
        question: 是否有赠品，赠品是什么
        answer: 不是的哦
      - category_name: 糖果专属
        question: 什么时候退定金
        answer: 不退
      - category_name: 学习桌椅
        question: 什么时候抽奖
        answer: 这边不能
      - category_name: 创意礼品
        question: 如何返现
        answer: 这边不能
      - category_name: 轮滑运动
        question: 货从哪发
        answer: 圆通不发
  - abnormal_name: 答非所问
    abnormal_type: 6
    dataProvider:
      - category_name: 数字电视
        question: 顺丰什么时间到货
        answer: 在的哦我
      - category_name: 抽水器专属
        question: 发什么快递
        answer: 亲亲在的饿哦
      - category_name: 婚庆用品
        question: 送不送挂钩，可以多送吗
        answer: 亲亲在的呢亲
      - category_name: 日常家居
        question: 分几个包裹
        answer: 在的呢去
  - abnormal_name: 对活动不熟悉
    abnormal_type: 10
    dataProvider:
      - category_name: 家电专属
        question: 尾款券在哪抽，有什么要求
        answer: 详情有的呢
      - category_name: 空调专属
        question: 双十一是否有优惠活动
        answer: 您可以首页参考下
      - category_name: 家纺专属
        question: 是否有赠品，赠品是什么
        answer: 页面上看下哦亲
#      - category_name: 冷暖风扇
#        question: 赠品是否和货一起发
#        answer: 详情有的呢
#      - category_name: 电商通用
#        question: 活动价是多少
#        answer: 您可以首页参考下亲亲
      - category_name: 全屋家电
        question: 赠品的颜色是否可以选择
        answer: 页面上看下哦亲
      - category_name: 办公文具
        question: 什么时候做活动
        answer: 页面看下详情
#      - category_name: 办公文具
#        question: 送不送转笔刀
#        answer: 页面说的很明白的哦
  - abnormal_name: 对产品不熟悉
    abnormal_type: 9
    dataProvider:
      - category_name: 吸尘器专属
        question: 是否带轮子
        answer: 给您看下亲亲
      - category_name: 灯饰专属
        question: 灯罩是什么材料
        answer: 我帮您看下哈
      - category_name: 冷暖风扇
        question: 过滤网能否拆卸
        answer: 亲稍等我给您查查
      - category_name: 沙发垫专属
        question: 是否会起球
        answer: 您可以参考详情页
beforeClass:
  name: 获取扣分行为类型id
  step:
    - byName: 随机获取一个类目
      name: 跟进类目名称获取类目
      extractor:
        - json:
            category_id: $.categories[?(@.name =~ /${category_name}.*?/i)].id
            category_name: $.categories[?(@.name =~ /${category_name}.*?/i)].name
    - byName: 切换类目-指定类目id
    - name: 获取扣分行为列表
      host: ${mc_test}
      url: /api/v1/abnormal/setting/list
      method: GET
      assertion: [json: {$.code: 0}]
      extractor:
        - json:
            setting_body: $.data.settings[?(@.type==${abnormal_type})]
testMethod:
  - name: ${abnormal_name}-${category_name}-开启-${question}-${answer}-扣${abnormal_score}分
    description: |
      """</br>
      用例描述：</br>
      1、${abnormal_name}-${category_name}--开启-${question}。</br>
      </br>
      测试步骤</br>
      1、${category_name}</br>
      2、开启${abnormal_name}检查</br>
      3、发送(${question})给商家</br>
      4、商家回复(${answer})</br>
      5、查看对话详情-校验质检结果</br>
      """
    dataProvider:
      - abnormal_score: 1
    severity: NORMAL
    step:
      - name: 开启扣分分行为监控开关
        host: ${mc_test}
        url: /api/v1/abnormal/setting/update
        method: POST
        body: ${setting_body}
        bodyEditor:
          json:
            $.score: ${__BeanShell(${abnormal_score})}
            $.check: true
        assertion: [json: {$.code: 0}]
      - byName: 发送消息给商家
      - name: 发送消息给买家
        sleep: 2
        url: /robot/report_client
        variables:
          a: ${__DES3Cipher(${answer},,)}
          pin: cntaobao${buyer_id}
          msg_time: ${__time(/1000,msg_time)}
          state: 1
          service_status: 7
          spin: cntaobao${seller_name}
          send_msg_from: 2
        method: GET
        assertion: [json: {$.code: 0}]
      - byName: 查询质检会话列表
      - byName: 查看对话详情
        name: 查看对话详情-扣分行为
        untilWait: 120
        intervals: 5000
        assertion:
          - json:
              $.code: 0
              $.data.messages[?(@.content=='${answer}' && @.source==1)].abnormal_score..type: ${abnormal_type}
              $.data.messages[?(@.content=='${answer}' && @.source==1)].abnormal_score..score: ${abnormal_score}
            assertionType: CONTAINS
afterClass:
  name: 测试结束后关闭质检
  step:
    - byName: 开启扣分分行为监控开关
      name: 关闭扣分分行为监控开关
      bodyEditor:
        json:
          $.check: false